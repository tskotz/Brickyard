<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>
    
    <link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="GetResource?AutomationToolbox/Preferences/Templates/Resources/jquery.contextMenu.css"/>
    <link rel="stylesheet" type="text/css" href="GetResource?AutomationToolbox/Preferences/Templates/Resources/dragtable-default.css"/>
  
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script type="text/javascript" src="GetResource?AutomationToolbox/Preferences/Templates/Resources/jquery.contextMenu.js"></script>
    <script type="text/javascript" src="GetResource?AutomationToolbox/Preferences/Templates/Resources/jquery.dragtable.js"></script>

    <style>
        body { font-size: 62.5%; }
        label, input { display:block; }
        input.text { margin-bottom:12px; width:95%; padding:.4em; }
        fieldset { padding:0; border:0; margin-top:25px; }
        h1 { font-size:2.2em; margin:.6em 0; }
        div#users-contain { width: 350px; margin: 20px 0; }
        div#users-contain table { margin:1em 0; border-collapse:collapse; width:100%; }
        div#users-contain table td, div#users-contain table th { border:1px solid #eee; padding:.6em 10px; text-align:left; }
        .ui-dialog .ui-state-error { padding:.3em; }
        .validateTips { border:1px solid transparent; padding:0.3em; }
        table#ParametersTable th { font-family:Arial; font-size:9pt;}
        table#ParametersTable tr:nth-child(even) { background-color:#ffffff; align:center; }
        table#ParametersTable tr:nth-child(odd) { background-color:#eeeeee; align:center; }
        .draggable tbody td { padding:2px; border:1px solid black; font-size:9pt; }
        .td-header-style { white-space:nowrap; vertical-align:top; }
    
        th:hover { background-color: #bbbbbb; xcolor: white; }
    </style>
    
    <script>
        $(function() {
          var dialog, form,
          
          // From http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#e-mail-state-%28type=email%29
          emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
          pname = $( "#pname" ),
          ptype = $( "#ptype" ),
          pvalue = $( "#pvalue" ),
          pdesc = $( "#pdesc" ),
          pAsList = $( "#asListcb" ),
          allFields = $( [] ).add( pname ).add( ptype ).add( pvalue ),
          tips = $( ".validateTips" );
          $( document ).tooltip();
                          
                          
          function updateTips( t ) {
              tips
                  .text( t )
                  .addClass( "ui-state-highlight" );
              setTimeout(function() { tips.removeClass( "ui-state-highlight", 1500 );}, 500 );
          }
          
          function checkLength( o, n, min, max ) {
              if ( o.val().length > max || o.val().length < min ) {
                  o.addClass( "ui-state-error" );
                  updateTips( "Length of " + n + " must be between " + min + " and " + max + "." );
                  return false;
              } else {
                  return true;
              }
          }
          
          function checkRegexp( o, regexp, n ) {
              if ( !( regexp.test( o.val() ) ) ) {
                  o.addClass( "ui-state-error" );
                  updateTips( n );
                  return false;
              } else {
                  return true;
              }
          }
          
          function addUser() {
              var valid = true;
              allFields.removeClass( "ui-state-error" );
          
              if ( valid ) {
                  var strValue= "<input type=\"text\" id=\"paramvalue\" style=\"display:table-cell; width:400\" value=\"" + pvalue.val() + "\">";
          
                  if( ptype.val() == "Boolean" ) {
                      if( pvalue.val().toLowerCase() == "true" )
                          strValue= "<select><option selected>True</option><option disabled>False</option></select>";
                      else
                          strValue= "<select><option disabled>True</option><option selected>False</option></select>";
                  }
                  else if( pAsList.is(':checked') ) {
                      strValue= "<select>";
                      var strList= pvalue.val().split(",");
                      for( var i in strList )
                          strValue+= "<option>" + strList[i].trim() + "</option>\n";
                      strValue+= "</select>";
                  }
          
                  $( "#ParametersTable tbody" ).append(
                                               "<tr>" +
                                               "<td><select id=\"dp_" + pname.val() + "\"><option selected>Active</option><option>Inactive</option><option>Edit</option><option>Remove</option></select></td>" +
                                               "<td title=\"Description: " + pdesc.val() + "\">" + pname.val() + "</td>" +
                                               "<td>" + ptype.val() + "</td>" +
                                               "<td>" + strValue +"</td>" +
                                               "</tr>" );
                  dialog.dialog( "close" );
              }
              return valid;
          }
          
          dialog = $( "#dialog-form" ).dialog({
                                              autoOpen: false,
                                              height: 340,
                                              width: 350,
                                              modal: true,
                                              buttons: {
                                                "Save": addUser,
                                                Cancel: function() { dialog.dialog( "close" ); }
                                              },
                                              close: function() {
                                                form[ 0 ].reset();
                                                allFields.removeClass( "ui-state-error" );
                                              }
                                            });
          
          form = dialog.find( "form" ).on( "submit", function( event ) {
                                          event.preventDefault();
                                          addUser();
                                        });
          
          $( "#create-user" ).button().on( "click", function() { dialog.dialog( "open" ); });
          
        });
    </script>

    <!-- Header and Row widget context menus -->
    <script type="text/javascript">
        /*
         Document this!
         */
        $(function(){
            $.contextMenu({
                selector: '.header-context-menu',
                trigger: 'left',
                callback: function(key, options) {
                    //var m = "header clicked: " + key;
                    //window.console && console.log(m) || alert(m);
                    var col = $(this).closest("td").index();
                    if( key == 'Edit')
                        $( "#dialog-form" ).dialog( "open" );
                    else if( key == 'Insert')
                        $("td").filter(":nth-child(" + (col + 1) + ")").css({backgroundColor: 'White'});
                    else if( key == 'Duplicate')
                        $("td").filter(":nth-child(" + (col + 1) + ")").css({backgroundColor: 'Blue'});
                    else if( key == 'Remove')
                        $("td").filter(":nth-child(" + (col + 1) + ")").css({backgroundColor: 'Orange'});
                    else if( key == 'Disable/Enable')
                        $("td").filter(":nth-child(" + (col + 1) + ")").css({backgroundColor: 'Gray'});
                },
                items: {
                    "Edit": {name: "Edit"},
                    "Disable/Enable": {name: "Disable"},
                    "Insert": {name: "Insert"},
                    "Duplicate": {name: "Duplicate"},
                    "Remove": {name: "Remove"}
                }
            });
          
            $('.header-context-menu').on('click', function(e){console.log('clicked header', this);})
        });
        
        /*
         Document this!
         */
        $(function(){
            $.contextMenu({
                selector: '.row-context-menu',
                trigger: 'left',
                callback: function(key, options) {
                    //var m = "row clicked: " + key;
                    var theRow= $(this).closest("table").closest("tr");
                    //alert(theRow.attr('id'));
                    if( key == 'Edit') {
                        var strDefaultPopup = '<table style="border-spacing:0px;border-style:none;"><tr style="background-color:transparent"><td><input type="checkbox" checked></td><td>Default</td></tr></table>\n'
                        theRow.css({backgroundColor: 'black'});
                        theRow.children("td").each(function() {
                            if( $(this).index() > 0 ) {
                                $(this).css({color:'White'});
                                if( $(this).text() == "true" )
                                    $(this).html(strDefaultPopup + '<select><option selected>True</option><option>False</option></select>');
                                else if( $(this).text() == "false" )
                                    $(this).html(strDefaultPopup + '<select><option>True</option><option selected>False</option></select>');
                                else
                                    $(this).html(strDefaultPopup + '<input type="text" style="display:table-cell; width:93%" value="' + $(this).text() + '">');
                            }
                        });
                    }
                    else if( key == 'Insert')
                        theRow.css({backgroundColor: 'White'});
                    else if( key == 'Duplicate')
                        theRow.css({backgroundColor: 'Blue'});
                    else if( key == 'Remove')
                        theRow.css({backgroundColor: 'Orange'});
                    else if( key == 'Disable')
                        theRow.css({backgroundColor: 'Gray'});
                },
                items: {
                    "Disable": {name: "Disable"},
                    "Edit": {name: "Edit"},
                    "Insert": {name: "Insert"},
                    "Duplicate": {name: "Duplicate"},
                    "Remove": {name: "Remove"}
                }
            });
          
           /* clean this up */
            $('.row-context-menu').on('click',
                    function(e){
                        console.log('clicked row', this);
                        var currentRow = $(this).closest('tr');
                        //alert(currentRow.attr('id'));
                    }
            )
        });
        
        
        /*
         Document this!
         */
        $(document).ready(function() {
            $('.defaultTable').dragtable();
                          
                          
            var fixHelperModified = function(e, tr) {
                var $originals = tr.children();
                var $helper = tr.clone();
                $helper.children().each(function(index) { $(this).width($originals.eq(index).width()) });
                return $helper;
            };
                          
            $("#ParametersTable tbody").sortable({ helper: fixHelperModified }).disableSelection();
        });
    </script>
</head>

<body>
    <!-- Insert Header -->
 
    <div id="dialog-form" title="Create New Parameter">
        <form>
            <fieldset>
                <label for="pname">Name</label>
                <input type="text" name="pname" id="pname" value="New Parameter" class="text ui-widget-content ui-corner-all">
                <label for="ptype">Type</label>
                <select id="ptype" style="float:left;" onclick="configureParamType()">
                    <option selected>String</option><option>Boolean</option><option>Float</option><option>Double</option><option>Int</option>
                </select>
                <input type="checkbox" id="asListcb" name="ltype" value="listtype" style="float:left;"> As List<br><br><br>
                <label id="pValueLabel" for="pvalue">Default Value</label>
                <input type="text" name="pvalue" id="pvalue" value="" class="text ui-widget-content ui-corner-all">
                <label for="pdesc">Description</label>
                <textarea name="pdesc" id="pdesc" value="Description of parameter" style="height:50px;vertical-align:top;width:100%" class="text ui-widget-content ui-corner-all"></textarea>
                <!-- Allow form submission with keyboard without duplicating the dialog button -->
                <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
            </fieldset>
        </form>
    </div>

    <h1 id="DataparamTitle"></h1>
    
    <table id="dpInfo">
        <tr>
            <td title="this is the auther">Author:</td>
            <td><input id="Author" type="text" value="Anonymous"></td>
        </tr>
        <tr>
            <td style="vertical-align:top">Description:</td>
            <td><textarea name="Description" id="Description" style="width:500px;height:50px;">None</textarea></td>
        </tr>
    </table>

    <!-- The Main Data Parameters Table -->
    <table id="ParametersTable" class="defaultTable">
    </table>
  
    <button id="create-user">Create new data parameter</button>
    <button id="Save">Save</button>
    <button id="SaveAs">Save As</button>
    <button id="Cancel" onclick="window.close()">Cancel</button>

</body>
</html>
