<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>
    
    <link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="GetResource?AutomationToolbox/Preferences/Templates/Resources/jquery.contextMenu.css"/>
    <link rel="stylesheet" type="text/css" href="GetResource?AutomationToolbox/Preferences/Templates/Resources/dragtable-default.css"/>
  
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.2.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script type="text/javascript" src="GetResource?AutomationToolbox/Preferences/Templates/Resources/jquery.contextMenu.js"></script>
    <script type="text/javascript" src="GetResource?AutomationToolbox/Preferences/Templates/Resources/jquery.dragtable.js"></script>

    <style>
        body { font-size: 62.5%; }
        label, input { display:block; }
        input.text { margin-bottom:12px; width:95%; padding:.4em; }
        fieldset { padding:0; border:0; margin-top:25px; }
        h1 { font-size:2.2em; margin:.6em 0; }
        div#users-contain { width: 350px; margin: 20px 0; }
        div#users-contain table { margin:1em 0; border-collapse:collapse; width:100%; }
        div#users-contain table td, div#users-contain table th { border:1px solid #eee; padding:.6em 10px; text-align:left; }
        .ui-dialog .ui-state-error { padding:.3em; }
        .validateTips { border:1px solid transparent; padding:0.3em; }
        table#ParametersTable th { font-family:Arial; font-size:9pt;}
        table#ParametersTable tr:nth-child(even) { background-color:#ffffff; align:center; }
        table#ParametersTable tr:nth-child(odd) { background-color:#eeeeee; align:center; }
        .draggable tbody td { padding:2px; border:1px solid black; font-size:9pt; }
        .td-header-style { white-space:nowrap; vertical-align:top; }
    
        th:hover { background-color: #bbbbbb; xcolor: white; }
    </style>
    
    <script>
        function RunURL( aUrl )
        {
            xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", aUrl, false );
            xmlHttp.setRequestHeader('Content-type', 'text/plain');
            xmlHttp.send( null );
            return xmlHttp.responseText;
        }
    </script>
    
    <script>
        $(function() {
          var dataParamEditorDialog, form,
          
          // From http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#e-mail-state-%28type=email%29
          emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
          pname = $( "#pname" ),
          ptype = $( "#ptype" ),
          pvalue = $( "#pvalue" ),
          pdesc = $( "#pdesc" ),
          pAsList = $( "#asListcb" ),
          allFields = $( [] ).add( pname ).add( ptype ).add( pvalue ),
          tips = $( ".validateTips" );
          $( document ).tooltip();
                          
                          
          function updateTips( t ) {
              tips
                  .text( t )
                  .addClass( "ui-state-highlight" );
              setTimeout(function() { tips.removeClass( "ui-state-highlight", 1500 );}, 500 );
          }
          
          function checkLength( o, n, min, max ) {
              if ( o.val().length > max || o.val().length < min ) {
                  o.addClass( "ui-state-error" );
                  updateTips( "Length of " + n + " must be between " + min + " and " + max + "." );
                  return false;
              } else {
                  return true;
              }
          }
          
          function checkRegexp( o, regexp, n ) {
              if ( !( regexp.test( o.val() ) ) ) {
                  o.addClass( "ui-state-error" );
                  updateTips( n );
                  return false;
              } else {
                  return true;
              }
          }
          
          function addUser() {
              var valid = true;
              allFields.removeClass( "ui-state-error" );
          
              if ( valid ) {
                  var strValue= "<input type=\"text\" id=\"paramvalue\" style=\"display:table-cell; width:400\" value=\"" + pvalue.val() + "\">";
          
                  if( ptype.val() == "Boolean" ) {
                      if( pvalue.val().toLowerCase() == "true" )
                          strValue= "<select><option selected>True</option><option disabled>False</option></select>";
                      else
                          strValue= "<select><option disabled>True</option><option selected>False</option></select>";
                  }
                  else if( pAsList.is(':checked') ) {
                      strValue= "<select>";
                      var strList= pvalue.val().split(",");
                      for( var i in strList )
                          strValue+= "<option>" + strList[i].trim() + "</option>\n";
                      strValue+= "</select>";
                  }
          
                  $( "#ParametersTable tbody" ).append(
                                               "<tr>" +
                                               "<td><select id=\"dp_" + pname.val() + "\"><option selected>Active</option><option>Inactive</option><option>Edit</option><option>Remove</option></select></td>" +
                                               "<td title=\"Description: " + pdesc.val() + "\">" + pname.val() + "</td>" +
                                               "<td>" + ptype.val() + "</td>" +
                                               "<td>" + strValue +"</td>" +
                                               "</tr>" );
                  dataParamEditorDialog.dialog( "close" );
              }
              return valid;
          }
             
          /*
           document this
           */
          function saveDataParameter() {
            var strStatus;
            var strTitle= $( "#createNewParameterDialog" ).dialog( "option", "title" );

            if( strTitle.indexOf("Edit Data Parameter:") == 0 )
                strStatus= RunURL( "/AutoManager/UpdateDataParameter?name="+pname.attr("origname")+"&newname="+pname.val()+"&type="+ptype.val()+"&value="+pvalue.val()+"&aslist="+pAsList.is(':checked')+"&descr="+pdesc.val() );
            else
                strStatus= RunURL( "/AutoManager/SaveDataParameter?name="+pname.val()+"&type="+ptype.val()+"&value="+pvalue.val()+"&aslist="+pAsList.is(':checked')+"&descr="+pdesc.val() );

            if( strStatus.toLowerCase() != "success" )
                alert( strStatus );
            else {
                $(this).data('activeTD').text(pname.val());
                dataParamEditorDialog.dialog( "close" );
            }
          }
          
          dataParamEditorDialog = $( "#createNewParameterDialog" ).dialog({
                                              autoOpen: false,
                                              height: 340,
                                              width: 350,
                                              modal: true,
                                              buttons: {
                                                "Save": saveDataParameter,
                                                "Insert": InsertDPColumn,
                                                Cancel: function() { dataParamEditorDialog.dialog( "close" ); }
                                              },
                                              close: function() {
                                                form[ 0 ].reset();
                                                allFields.removeClass( "ui-state-error" );
                                              }
                                            });
          
          form = dataParamEditorDialog.find( "form" ).on( "submit", function( event ) {
                                          event.preventDefault();
                                          addUser();
                                        });
          
          $( "#create-user" ).button().on( "click", function() { dataParamEditorDialog.dialog( "open" ); });
          
        });
    </script>
    
    <!-- Header widget context menus -->
    <script type="text/javascript">
        /*
         document this
         */
        function EditRow( theRow ) {
            var strDefaultPopup = '<table style="border-spacing:0px;border-style:none;"><tr style="background-color:transparent"><td><input type="checkbox" checked></td><td>Default</td></tr></table>\n'
            theRow.css({backgroundColor: 'black'});
            theRow.children("td").each(function() {
                if( $(this).index() == 0) {
                    $(this).html( "<img id=\"customImage\" class=\"row-context-editmenu box menu-1\" src=\"/AutoManager/GetImage?AutomationToolbox/Preferences/Templates/Images/optbutton.png\" onmouseover=\"\" style=\"cursor:pointer;vertical-align:middle;\" height=\"10\" width=\"10\">" );
                }
                if( $(this).index() > 0 ) {
                    $(this).css({color:'White'});
                if( $(this).text() == "true" )
                    $(this).html(strDefaultPopup + '<select id="paramBoolVal"><option selected>True</option><option>False</option></select>');
                else if( $(this).text() == "false" )
                    $(this).html(strDefaultPopup + '<select id="paramBoolVal"><option>True</option><option selected>False</option></select>');
                else
                    $(this).html(strDefaultPopup + '<input id="paramTextVal" type="text" style="display:table-cell; width:93%" value="' + $(this).text() + '">');
                }
            });
        }
    
        /*
         Document this!
         */
        function ApplyRowEdits( theRow ) {
            if( confirm( "Click OK to apply changes" ) ) {
                theRow.css({backgroundColor: ''});
                theRow.children('td').each( function() {
                    if( $(this).index() == 0 ) {
                        $(this).html( "<img id=\"customImage\" class=\"row-context-menu box menu-1\" src=\"/AutoManager/GetImage?AutomationToolbox/Preferences/Templates/Images/optbutton.png\" onmouseover=\"\" style=\"cursor:pointer;vertical-align:middle;\" height=\"10\" width=\"10\">" );
                    }
                    else {
                        $(this).css({color:'Black'});
                        var strText= "";
                        if( $(this).find('option:selected').text() )
                            strText= $(this).find('option:selected').text().toLowerCase();
                        else if( $(this).children(':text') )
                            strText= $(this).children(':text').val();
               
                        $(this).html( strText );
                    }
               });
            }
        }
    
        /*
         Document this!
         */
        function CancelRowEdits( theRow ) {
            if( confirm( "Are you sure you want to remove the row?" ) )
                theRow.remove();
        }

        /*
        Document This!
        */
        function configureInsertDPColumn( dataParamName ) {
            var info= RunURL( "/AutoManager/GetDataParameter?" + dataParamName );
            var items= info.split(";");
            document.getElementById( "pnameslist" ).value= items[0];
            document.getElementById( "pvalue2" ).value= items[1];
            document.getElementById( "ptype2" ).value= items[2];
            document.getElementById( "asListcb2" ).checked= (items[3] == "true");
            document.getElementById( "pdesc2" ).value= items[4];
        }
    
        /*
         Document this!
         */
        $(function(){
            $.contextMenu({
                selector: '.header-context-menu',
                trigger: 'left',
                callback: function(key, options) {
                    //var m = "header clicked: " + key;
                    //window.console && console.log(m) || alert(m);
                    var theTable= $(this).closest("table");
                    var thisTD= $(this).closest("td");
                    var col = thisTD.index();
                    var dataParamName= thisTD.text().trim();
                          
                    if( key == 'Edit') {
                        var info= RunURL( "/AutoManager/GetDataParameter?" + dataParamName );
                        var items= info.split(";");
                        document.getElementById( "pname" ).value= items[0];
                        document.getElementById( "pname" ).setAttribute("origname", items[0]);
                        document.getElementById( "pvalue" ).value= items[1];
                        document.getElementById( "ptype" ).value= items[2];
                        document.getElementById( "asListcb" ).value= (items[3] == "true");
                        document.getElementById( "pdesc" ).value= items[4];
                          
                        $( "#createNewParameterDialog" ).dialog({ title: "Edit Data Parameter: " + dataParamName }).data("activeTD", thisTD).dialog( "open" );
                    }
                    else if( key == 'New') {
                        $( "#createNewParameterDialog" ).dialog({ title: "New Data Parameter"}).dialog( "open" );
                    }
                    else if( key == 'Insert') {
                          var strDataParams= RunURL( "/AutoManager/GetAllDataParameterNames" );
                          var elmnt= document.getElementById( "pnameslist" );
                          var items= strDataParams.split(', ');
                          for( i=0; i<items.length; i++)
                          {
                              var option = document.createElement("option");
                              option.text = items[i];
                              option.value = items[i];
                              elmnt.add(option);
                          }

                        $( "#InsertDPColumn" ).data("activeTD", thisTD).dialog( "open" );
                    }
                    else if( key == 'Remove') {
                        if( confirm( "Are you sure you want to remove column " + dataParamName + "?" ) )
                            $("td").filter(":nth-child(" + (col + 1) + ")").remove();
                    }
                    else if( key == 'Disable/Enable')
                        $("td").filter(":nth-child(" + (col + 1) + ")").css({backgroundColor: 'Gray'});
                },
                items: {
                    "Edit": {name: "Edit"},
                    "Disable/Enable": {name: "Disable"},
                    "Insert": {name: "Insert"},
                    "Remove": {name: "Remove"},
                    "New": {name: "New"}
                }
            });
          
            $('.header-context-menu').on('click', function(e){console.log('clicked header', this);})
        });
        
        /*
         <!-- Row widget context menus -->
         */
        $(function(){
            $.contextMenu({
                selector: '.row-context-menu',
                trigger: 'left',
                callback: function(key, options) {
                    //var m = "row clicked: " + key;
                    var theRow= $(this).closest("tr");
                    //alert(theRow.attr('id'));
                    if( key == 'Edit') {
                        EditRow( theRow );
                    }
                    else if( key == 'Insert') {
                        var theTable= $(this).closest("table");
                        var defaultRow= theTable.find('tr:nth-child(2)')
                        var clone= theRow.clone()
                        clone.children('td').each (function() {
                            if( $(this).index() == 0) {
                                $(this).html( "<img id=\"customImage\" class=\"row-context-editmenu box menu-1\" src=\"/AutoManager/GetImage?AutomationToolbox/Preferences/Templates/Images/optbutton.png\" onmouseover=\"\" style=\"cursor:pointer;vertical-align:middle;\" height=\"10\" width=\"10\">" );
                            }
                            else if( $(this).index() == 1 )
                                $(this).html( "unnamed" );
                            else if( $(this).index() > 1 ) {
                                var strText= "";
                                if( defaultRow.children('td').eq($(this).index()).find('option').html() )
                                    strText= defaultRow.children('td').eq($(this).index()).find('option:selected').text().toLowerCase();
                                else if( defaultRow.children('td').eq($(this).index()).find('input') )
                                    strText= defaultRow.children('td').eq($(this).index()).find('input').val();
                                               
                                $(this).html( strText );
                            }
                        });
                        clone.insertAfter(theRow);
                        EditRow( clone );
                    }
                    else if( key == 'Duplicate') {
                        var clone= theRow.clone()
                        clone.insertAfter(theRow);
                        clone.children("td").eq(1).text( clone.children("td").eq(1).text() + " - copy");
                        EditRow( clone );
                    }
                    else if( key == 'Remove') {
                          if( confirm( "Are you sure you want to remove the row?" ) )
                            theRow.remove();
                    }
                    else if( key == 'Disable')
                        theRow.css({backgroundColor: 'Gray'});
                },
                items: {
                    "Disable": {name: "Disable"},
                    "Edit": {name: "Edit"},
                    "Insert": {name: "Insert"},
                    "Duplicate": {name: "Duplicate"},
                    "Remove": {name: "Remove"}
                }
            });
          
           /* clean this up */
            $('.row-context-menu').on('click',
                    function(e){
                        console.log('clicked row', this);
                        var currentRow = $(this).closest('tr');
                        //alert(currentRow.attr('id'));
                    }
            )
        });

        /*
         <!-- Row widget context menus -->
         */
        $(function(){
            $.contextMenu({
                selector: '.row-context-editmenu',
                trigger: 'left',
                callback: function(key, options) {
                    var theRow= $(this).closest("tr");
                    if( key == 'Apply') {
                          ApplyRowEdits( theRow );
                    }
                    else if( key == 'Cancel') {
                            CancelRowEdits( theRow );
                    }
                 },
                items: {
                    "Apply": {name: "Apply"},
                    "Cancel": {name: "Cancel"}
                }
            });
          
           /* clean this up */
            $('.row-context-editmenu').on('click',
                    function(e){
                        console.log('clicked row', this);
                        var currentRow = $(this).closest('tr');
                        //alert(currentRow.attr('id'));
                    }
            )
        });
        
        
        /*
         Document this!
         */
        $(document).ready(function() {
            $('.defaultTable').dragtable();
                          
                          
            var fixHelperModified = function(e, tr) {
                var $originals = tr.children();
                var $helper = tr.clone();
                $helper.children().each(function(index) { $(this).width($originals.eq(index).width()) });
                return $helper;
            };
                          
            $("#ParametersTable tbody").sortable({ helper: fixHelperModified }).disableSelection();
        });
        
        $(function () {
          
          function DoInsertDPColumn() {
            var i= $(this).data('activeTD').index();
            $('#ParametersTable tbody').find('tr').each(function() {
                var htmlData= "";
                if( $(this).index() == 0 )
                    htmlData= '&nbsp' + document.getElementById( "pnameslist" ).value + ' <img id="customImage" class="header-context-menu box menu-1" src="/AutoManager/GetImage?AutomationToolbox/Preferences/Templates/Images/optbutton.png" onmouseover="" style="cursor:pointer;vertical-align:middle;" height="10" width="10">&nbsp';
                else if( $(this).index() == 1 )
                    htmlData= '<input type="text" style="width: 100%;" id="paramvalue" value="'+document.getElementById( "pvalue2" ).value+'">';
                else
                    htmlData= document.getElementById( "pvalue2" ).value
                $(this).find('td').eq(i).after('<td>'+htmlData+'</td>');
            });
            insertDPDialog.dialog( "close" );
          }
    
          var insertDPDialog;
          
          $("#ParametersTable td").dblclick(function (e) {
                                        e.stopPropagation();      //<-------stop the bubbling of the event here
                                        var currentEle = $(this);
                                        var value = $(this).html();
                                        alert(value);
                                      });

         insertDPDialog = $( "#InsertDPColumn" ).dialog({
                                                 autoOpen: false,
                                                 height: 340,
                                                 width: 350,
                                                 modal: true,
                                                 buttons: {
                                                    "Insert": DoInsertDPColumn,
                                                    Cancel: function() { insertDPDialog.dialog( "close" ); }
                                                 },
                                                 close: function() {
                                                    form[ 0 ].reset();
                                                 }
                                                 });
                                                 
                                                 form = insertDPDialog.find( "form" ).on( "submit", function( event ) {
                                                                                            event.preventDefault();
                                                                                            //addUser();
                                                                                       });
        });

function ShowNewDPDialog() {
    $( "#InsertDPColumn" ).dialog( "close" );
    $( "#createNewParameterDialog" ).dialog({ title: "New Data Parameter"}).dialog( "open" );
    
}

    </script>
</head>

<body>
    <!-- Insert Header -->
 
    <div id="createNewParameterDialog" title="Create New Parameter">
        <form>
            <fieldset>
                <label for="pname">Name</label>
                <input type="text" name="pname" id="pname" origname="" value="New Parameter" class="text ui-widget-content ui-corner-all">
                <label for="ptype">Type</label>
                <select id="ptype" style="float:left;" onclick="configureParamType()">
                    <option selected>String</option><option>Boolean</option><option>Float</option><option>Double</option><option>Int</option>
                </select>
                <input type="checkbox" id="asListcb" name="asListcb" value="listtype" style="float:left;"> As List<br><br><br>
                <label id="pValueLabel" for="pvalue">Default Value</label>
                <input type="text" name="pvalue" id="pvalue" value="" class="text ui-widget-content ui-corner-all">
                <label for="pdesc">Description</label>
                <textarea name="pdesc" id="pdesc" value="Description of parameter" style="height:50px;vertical-align:top;width:100%" class="text ui-widget-content ui-corner-all"></textarea>
                <!-- Allow form submission with keyboard without duplicating the dialog button -->
                <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
            </fieldset>
        </form>
    </div>

    <div id="InsertDPColumn" title="Insert Data Parameter Column">
        <form>
            <fieldset>
                <label for="pnameslist">Name</label>
                <select id="pnameslist" style="float:left;" onclick="configureInsertDPColumn(value)">
                    <option selected>--Select--</option>
                </select>
                <button onclick="ShowNewDPDialog()">New</button><br><br><br>
                <label for="ptype2">Type</label>
                <select id="ptype2" style="float:left;" disabled>
                    <option selected>String</option><option>Boolean</option><option>Float</option><option>Double</option><option>Int</option>
                </select>
                <input type="checkbox" id="asListcb2" name="asListcb2" value="listtype" style="float:left;" disabled> As List<br><br><br>
                <label id="pValueLabel2" for="pvalue2">Default Value</label>
                <input type="text" name="pvalue2" id="pvalue2" value="" class="text ui-widget-content ui-corner-all" disabled>
                <label for="pdesc2">Description</label>
                <textarea name="pdesc2" id="pdesc2" value="Description of parameter" style="height:50px;vertical-align:top;width:100%" class="text ui-widget-content ui-corner-all" disabled></textarea>
                <!-- Allow form submission with keyboard without duplicating the dialog button -->
                <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
            </fieldset>
        </form>
    </div>

    <h1 id="DataparamTitle"></h1>
    
    <table id="dpInfo">
        <tr>
            <td title="this is the auther">Author:</td>
            <td><input id="Author" type="text" value="Anonymous"></td>
        </tr>
        <tr>
            <td style="vertical-align:top">Description:</td>
            <td><textarea name="Description" id="Description" style="width:500px;height:50px;">None</textarea></td>
        </tr>
    </table>

    <!-- The Main Data Parameters Table -->
    <table id="ParametersTable" class="defaultTable">
    </table>
  
    <button id="create-user">Create new data parameter</button>
    <button id="Save">Save</button>
    <button id="SaveAs">Save As</button>
    <button id="Cancel" onclick="window.close()">Cancel</button>

</body>
</html>
